@using BlazorFinance.Shared.Entities
@inject HttpClient Http

<DataGridSelectColumn 
    TItem="Expense"
    Field="@nameof(Expense.Account)"
    Caption="@Caption"
    Editable="true">
    <DisplayTemplate>
        @if (_accounts != null){
            @_accounts.Where(i => i.Id == (context as Expense).Account?.Id)?.FirstOrDefault()?.Name;
        }
    </DisplayTemplate>
    <EditTemplate>
        <Select TValue="int"
                SelectedValue="@((int)((Account)context.CellValue).Id)"
                SelectedValueChanged="@( v => context.CellValue = _accounts.First(x => x.Id == v))">
            <SelectItem TValue="Account" Value="null">Select...</SelectItem>
            @if (_accounts != null)
            {
                foreach (var account in _accounts)
                {
                    <SelectItem TValue="int" Value="@(account.Id)">@(account.Name)</SelectItem>
                }
            }
        </Select>
    </EditTemplate>
</DataGridSelectColumn>

@code {
    private List<Account> _accounts = new List<Account>();

    [Parameter]
    public string Caption { get; set; } = string.Empty;

    [Parameter]
    public string Field { get; set; } = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        _accounts = await Http.GetFromJsonAsync<List<Account>>("account") ?? new List<Account>();
    }
}
